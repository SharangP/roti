{% extends "base.html" %}

{% block head %}
<style>

  .description{
      padding-top: 5px;
  }

  .vendor-container {
    padding-top: 10px;
    padding-bottom: 10px;
  }

  .vendor-list {
    height: 400px; /*TODO: fix this*/
    padding-top: 10px;
    padding-bottom: 50px;
    margin-bottom: 0;
    overflow: auto;
  }

  #map {
    width:100%;
    height:400px;
  }

</style>

<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css' rel='stylesheet' />

<script>
//TODO use actual mapbox api
L.mapbox.accessToken = 'pk.eyJ1IjoiYnVoYnVoIiwiYSI6Ilh5bkRKUUUifQ.olgIk6gNL_tuWx_HtqircQ';
$(document).ready(function() {
  var geocoder = L.mapbox.geocoder('mapbox.places');
  var map = L.mapbox.map('map', 'mapbox.streets').setView([38.9, -77], 15);
  var addPoint = function(address, pinNumber) {
      geocoder.query(address, function(err, data) {
        if (data.latlng) {
          map.setView([data.latlng[0], data.latlng[1]], 15);
          var fixedMarker = L.marker(new L.LatLng(data.latlng[0], data.latlng[1]), {
              icon: L.mapbox.marker.icon({
                  'marker-color': 'ff8888'
              })
          }).bindPopup(address).addTo(map);
        }
      });
  }
  $(".address").each( function(i,vendor) {
      addPoint(vendor.textContent, 1);
  });
});
</script>
{% endblock %}

{% block content %}
<h1>Results</h1>
<h4>Results for <i>"{{query}}"</i></h4>

<div class="row vendor-container">
  <div class="col-lg-6 vendor-list">
    <div class="list-group">
        {% for vendor in vendors %}
            <a class="list-group-item row" href="vendor/{{vendor.id}}">
                <div class="col-lg-3">
                    <img src="{{ vendor.image }}" />
                </div>
                <h4 class="list-group-item-heading">{{ vendor.user.get_name()}}</h4>
                <i class="list-group-item-text address">{{ vendor.address }}</i>
                <p class="list-group-item-text description">{{ vendor.description }}</p>
            </a>
        {% endfor %}
     </div>
  </div>

  <div class="col-lg-5">
    <div id='map'></div>
  </div>

</div>
{% endblock %}
